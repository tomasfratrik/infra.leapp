---
- name: Test full system upgrade role to 9
  hosts: all
  gather_facts: true
  become: true
  vars:
    leapp_upgrade_type: cdn
    leapp_upgrade_opts: --target 9.6
  tasks:
    - name: Print system version BEFORE upgrade
      debug:
        msg: >
          Before upgrade: {{ ansible_distribution }}
          {{ ansible_distribution_version }}
          (major {{ ansible_distribution_major_version }})

    # - name: analysis-leapp | Install packages for preupgrade analysis on RHEL 8
    #   ansible.builtin.package:
    #     name: "{{ analysis_packages_el8 }}"
    #     enablerepo: "{{ analysis_repos_el8 }}"
    #     state: latest # noqa package-latest
    #   when: ansible_distribution_major_version|int == 8

    - name: Ensure leapp-upgrade is installed
      ansible.builtin.dnf:
        name: leapp-upgrade
        state: present

    - name: Run the upgrade role
      include_role:
        name: upgrade

    - name: Refresh facts AFTER upgrade
      setup:
        gather_subset:
          - distribution
          - distribution_version
          - distribution_major_version

    - name: Print system version AFTER upgrade
      debug:
        msg: >
          After upgrade: {{ ansible_distribution }}
          {{ ansible_distribution_version }}
          (major {{ ansible_distribution_major_version }})

